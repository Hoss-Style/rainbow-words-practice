<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rainbow Words Game</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Comic Sans MS', 'Chalkboard SE', 'Arial Rounded MT Bold', sans-serif;
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #a18cd1 100%);
      min-height: 100vh;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      padding: 20px 0 50px;
      position: relative;
    }

    .star {
      position: fixed; font-size: 2rem;
      animation: floatStar 6s ease-in-out infinite;
      opacity: 0.3; pointer-events: none; z-index: 0;
    }
    @keyframes floatStar {
      0%,100% { transform: translateY(0) rotate(0deg); }
      50%      { transform: translateY(-20px) rotate(20deg); }
    }

    /* â”€â”€ Main card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .game-card {
      background: white; border-radius: 40px;
      padding: 28px 36px 44px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      max-width: 680px; width: 95%;
      position: relative; z-index: 1;
    }

    .title {
      font-size: 2.1rem; color: #ff6b6b;
      margin-bottom: 16px;
      text-shadow: 2px 2px 0 #ffd93d;
    }

    /* â”€â”€ Mode toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .mode-toggle {
      display: flex; gap: 12px;
      justify-content: center;
      margin-bottom: 18px;
    }

    .mode-toggle-btn {
      font-family: inherit; font-size: 1.25rem; font-weight: bold;
      padding: 14px 28px; border: 4px solid transparent;
      border-radius: 30px; cursor: pointer;
      transition: all 0.2s; flex: 1; max-width: 220px;
      box-shadow: 0 4px 0 rgba(0,0,0,0.12);
      user-select: none;
    }

    /* inactive state */
    .mode-toggle-btn.inactive {
      background: #f0f0f0; color: #aaa;
      border-color: #e0e0e0;
      box-shadow: 0 2px 0 rgba(0,0,0,0.06);
      transform: scale(0.95);
    }

    /* active flashcard */
    .mode-toggle-btn.active-flash {
      background: linear-gradient(135deg,#4cc9f0,#4361ee);
      color: white; border-color: #4361ee;
      box-shadow: 0 5px 0 rgba(67,97,238,0.35);
      transform: scale(1.03);
    }

    /* active quiz */
    .mode-toggle-btn.active-quiz {
      background: linear-gradient(135deg,#f77f00,#f72585);
      color: white; border-color: #f72585;
      box-shadow: 0 5px 0 rgba(247,37,133,0.35);
      transform: scale(1.03);
    }

    .mode-toggle-btn:hover { filter: brightness(1.07); }

    /* â”€â”€ Color filter panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .color-panel {
      background: #f8f8f8; border-radius: 24px;
      padding: 14px 18px; margin-bottom: 16px;
      border: 2px dashed #ddd;
    }
    .color-panel-title { font-size: 1rem; color: #888; margin-bottom: 10px; font-weight: bold; }
    .color-checks { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }

    .color-check-label {
      display: flex; align-items: center; gap: 8px;
      padding: 7px 16px; border-radius: 30px;
      cursor: pointer; font-size: 1rem; font-weight: bold;
      color: white; border: 3px solid transparent;
      transition: opacity 0.2s, transform 0.15s;
      user-select: none; -webkit-user-select: none;
    }
    /* Hide native checkbox â€” use custom box instead */
    .color-check-label input[type="checkbox"] {
      position: absolute; opacity: 0; width: 0; height: 0; pointer-events: none;
    }
    /* Custom checkmark box */
    .color-check-label .custom-cb {
      display: inline-flex; align-items: center; justify-content: center;
      width: 22px; height: 22px; border-radius: 6px; flex-shrink: 0;
      background: rgba(255,255,255,0.25);
      border: 2px solid rgba(255,255,255,0.7);
      font-size: 14px; line-height: 1;
      transition: background 0.15s;
    }
    .color-check-label input[type="checkbox"]:checked + .custom-cb {
      background: white;
      color: #333;
    }
    .color-check-label input[type="checkbox"]:checked + .custom-cb::after {
      content: 'âœ“';
      font-weight: bold;
    }
    .color-check-label.unchecked { opacity: 0.38; transform: scale(0.93); }

    .label-purple   { background: #7b5ea7; }
    .label-blue     { background: #4361ee; }
    .label-green    { background: #2d9e6b; }
    .label-yellow   { background: #c8a200; }
    .label-orange   { background: #e07000; }
    .label-red      { background: #d62828; }
    .label-sunshine { background: #b8860b; }

    .mini-btn {
      font-family: inherit; font-size: 0.85rem; padding: 5px 14px;
      border-radius: 20px; border: 2px solid #bbb; background: white;
      color: #666; cursor: pointer; font-weight: bold;
      transition: all 0.15s; margin-top: 8px;
    }
    .mini-btn:hover { background: #eee; }

    /* â”€â”€ Progress dots â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-dots {
      display: flex; justify-content: center;
      gap: 7px; margin-bottom: 18px; flex-wrap: wrap;
    }
    .dot {
      width: 16px; height: 16px; border-radius: 50%;
      background: #ddd; transition: background 0.3s, transform 0.2s;
    }
    .dot.done    { background: #90be6d; }
    .dot.current { background: #4cc9f0; transform: scale(1.3); }
    .dot.correct { background: #90be6d; }
    .dot.wrong   { background: #ff6b6b; }

    /* â”€â”€ No-words msg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .no-words-msg {
      display: none; font-size: 1.4rem; color: #d62828;
      background: #fff0f0; border: 3px solid #f7c5c5;
      border-radius: 20px; padding: 20px; margin: 10px 0;
    }
    .no-words-msg.show { display: block; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FLASHCARD MODE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #flashcard-area { display: none; }
    #flashcard-area.show { display: block; }

    .fc-counter { font-size: 1rem; color: #aaa; margin-bottom: 10px; font-weight: bold; }

    .flashcard {
      border-radius: 32px;
      padding: 36px 30px 28px;
      margin-bottom: 22px;
      border: 5px solid transparent;
      cursor: pointer; position: relative;
      transition: transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 8px 30px rgba(0,0,0,0.13);
      user-select: none; -webkit-user-select: none;
    }
    .flashcard:hover  { transform: scale(1.025); box-shadow: 0 12px 40px rgba(0,0,0,0.18); }
    .flashcard:active { transform: scale(0.975); }

    .fc-word {
      font-size: 6rem; font-weight: bold;
      letter-spacing: 6px;
      text-shadow: 4px 4px 0 rgba(0,0,0,0.08);
      line-height: 1;
    }
    .fc-tap-hint { font-size: 1rem; margin-top: 12px; opacity: 0.55; font-weight: bold; }

    /* sound rings */
    .fc-rings {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      pointer-events: none;
    }
    .ring {
      position: absolute; border-radius: 50%;
      border: 4px solid rgba(255,255,255,0.5);
      top: 50%; left: 50%;
      transform: translate(-50%,-50%) scale(0); opacity: 0;
    }
    .flashcard.speaking .ring:nth-child(1) { animation: ringOut 1.2s ease-out 0s infinite; }
    .flashcard.speaking .ring:nth-child(2) { animation: ringOut 1.2s ease-out 0.3s infinite; }
    .flashcard.speaking .ring:nth-child(3) { animation: ringOut 1.2s ease-out 0.6s infinite; }
    @keyframes ringOut {
      0%   { transform:translate(-50%,-50%) scale(0.3); opacity:0.9; width:80px; height:80px; }
      100% { transform:translate(-50%,-50%) scale(2.8); opacity:0;   width:80px; height:80px; }
    }

    /* flashcard color themes */
    .fc-purple   { background:#ece0ff; border-color:#9b72cf; } .fc-purple   .fc-word { color:#5a2d82; }
    .fc-blue     { background:#dde8ff; border-color:#4361ee; } .fc-blue     .fc-word { color:#1a2fa8; }
    .fc-green    { background:#d4f5e9; border-color:#2d9e6b; } .fc-green    .fc-word { color:#1a5e40; }
    .fc-yellow   { background:#fff9c4; border-color:#e0b800; } .fc-yellow   .fc-word { color:#7a6000; }
    .fc-orange   { background:#ffe8cc; border-color:#e07000; } .fc-orange   .fc-word { color:#7a3800; }
    .fc-red      { background:#ffd6d6; border-color:#d62828; } .fc-red      .fc-word { color:#7a0000; }
    .fc-sunshine { background:#fffacc; border-color:#c8a200; } .fc-sunshine .fc-word { color:#6b5200; }

    .fc-color-label { font-size:1rem; font-weight:bold; opacity:0.65; margin-top:8px; }

    .fc-seen-badge {
      position:absolute; top:-10px; right:-10px;
      background:#90be6d; color:white; font-size:1.4rem;
      width:36px; height:36px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 3px 8px rgba(0,0,0,0.2);
      opacity:0; transition:opacity 0.3s;
    }
    .fc-seen-badge.visible { opacity:1; }

    /* â”€â”€ Flag button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .flag-btn {
      position: absolute; top: 12px; left: 14px;
      background: none; border: none;
      font-size: 2rem; cursor: pointer;
      line-height: 1; padding: 4px 6px;
      border-radius: 12px;
      transition: transform 0.15s, background 0.15s;
      z-index: 2;
      filter: grayscale(1) opacity(0.35);
    }
    .flag-btn:hover { transform: scale(1.25); background: rgba(0,0,0,0.06); filter: none; }
    .flag-btn.flagged {
      filter: none;
      animation: flagPop 0.25s ease;
    }
    @keyframes flagPop {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.4) rotate(-8deg); }
      100% { transform: scale(1); }
    }

    /* flagged word filter row */
    .flag-filter-row {
      display: flex; align-items: center; justify-content: center;
      gap: 10px; margin-bottom: 14px; flex-wrap: wrap;
    }
    .flag-filter-btn {
      font-family: inherit; font-size: 1rem; font-weight: bold;
      padding: 8px 20px; border-radius: 24px; cursor: pointer;
      border: 3px solid #ffb3b3;
      background: white; color: #d62828;
      transition: all 0.18s;
      display: flex; align-items: center; gap: 6px;
    }
    .flag-filter-btn.active {
      background: #d62828; color: white; border-color: #d62828;
      box-shadow: 0 4px 0 rgba(214,40,40,0.3);
    }
    .flag-filter-btn:hover { filter: brightness(1.06); }
    .flag-count-badge {
      background: #ff6b6b; color: white;
      font-size: 0.85rem; font-weight: bold;
      padding: 1px 7px; border-radius: 20px;
      min-width: 22px; text-align: center;
    }
    .flag-filter-btn.active .flag-count-badge { background: rgba(255,255,255,0.3); }

    /* flagged dot style */
    .dot.flagged-dot { background: #ff6b6b; }
    .dot.flagged-dot.current { background: #d62828; }

    /* nav buttons */
    .fc-nav { display:flex; align-items:center; justify-content:center; gap:16px; margin-top:4px; }

    .fc-nav-btn {
      font-family:inherit; font-size:1.5rem; font-weight:bold;
      padding:14px 32px; border:none; border-radius:24px;
      cursor:pointer; color:white;
      box-shadow:0 5px 0 rgba(0,0,0,0.15);
      transition:transform 0.12s, box-shadow 0.12s;
      user-select:none;
    }
    .fc-nav-btn:hover  { transform:scale(1.06) translateY(-2px); box-shadow:0 8px 0 rgba(0,0,0,0.15); }
    .fc-nav-btn:active { transform:scale(0.96) translateY(2px);  box-shadow:0 2px 0 rgba(0,0,0,0.15); }

    .btn-prev { background:linear-gradient(135deg,#adb5bd,#6c757d); }
    .btn-next { background:linear-gradient(135deg,#4cc9f0,#4361ee); font-size:1.6rem; padding:16px 40px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       QUIZ MODE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #quiz-area { display:none; }
    #quiz-area.show { display:block; }

    .score-bar {
      display:flex; justify-content:center;
      gap:28px; margin-bottom:14px; font-size:1.2rem; color:#666;
    }
    .score-item span { font-size:1.6rem; font-weight:bold; }
    #star-count   { color:#f9c74f; }
    #streak-count { color:#90be6d; }

    .quiz-instruction { font-size:1.3rem; color:#888; margin-bottom:12px; }

    .target-word-box {
      border-radius:30px; padding:20px 40px;
      margin-bottom:22px; border:4px solid transparent;
      transition:background 0.4s, border-color 0.4s;
      cursor:pointer;
    }
    .target-word-box:hover { opacity:0.9; }

    .target-word {
      font-size:4.5rem; font-weight:bold;
      letter-spacing:6px; text-shadow:3px 3px 0 rgba(0,0,0,0.1);
      line-height:1; word-break:break-all; transition:color 0.4s;
    }
    .rainbow-label { font-size:1rem; margin-top:4px; opacity:0.7; font-weight:bold; }

    .speak-row { margin-top:12px; }
    .speak-btn {
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 26px; font-family:inherit; font-size:1.3rem;
      font-weight:bold; border:none; border-radius:50px;
      background:linear-gradient(135deg,#06d6a0,#118ab2);
      color:white; cursor:pointer;
      box-shadow:0 5px 0 rgba(0,0,0,0.18);
      transition:transform 0.12s, box-shadow 0.12s;
      user-select:none;
    }
    .speak-btn:hover  { transform:scale(1.07) translateY(-2px); }
    .speak-btn:active { transform:scale(0.96) translateY(2px); }
    .speak-btn .speaker-icon { font-size:1.5rem; }
    .speak-btn.speaking {
      background:linear-gradient(135deg,#f72585,#b5179e);
      animation:speakPulse 0.6s ease-in-out infinite alternate;
    }
    @keyframes speakPulse { 0%{transform:scale(1);} 100%{transform:scale(1.07);} }

    /* quiz word-box color themes */
    .theme-purple   { background:#ece0ff; border-color:#9b72cf; } .theme-purple   .target-word{color:#5a2d82;} .theme-purple   .rainbow-label{color:#7b5ea7;}
    .theme-blue     { background:#dde8ff; border-color:#4361ee; } .theme-blue     .target-word{color:#1a2fa8;} .theme-blue     .rainbow-label{color:#4361ee;}
    .theme-green    { background:#d4f5e9; border-color:#2d9e6b; } .theme-green    .target-word{color:#1a5e40;} .theme-green    .rainbow-label{color:#2d9e6b;}
    .theme-yellow   { background:#fff9c4; border-color:#e0b800; } .theme-yellow   .target-word{color:#7a6000;} .theme-yellow   .rainbow-label{color:#a88500;}
    .theme-orange   { background:#ffe8cc; border-color:#e07000; } .theme-orange   .target-word{color:#7a3800;} .theme-orange   .rainbow-label{color:#e07000;}
    .theme-red      { background:#ffd6d6; border-color:#d62828; } .theme-red      .target-word{color:#7a0000;} .theme-red      .rainbow-label{color:#d62828;}
    .theme-sunshine { background:#fffacc; border-color:#c8a200; } .theme-sunshine .target-word{color:#6b5200;} .theme-sunshine .rainbow-label{color:#b8860b;}

    /* choice buttons */
    .choices { display:flex; flex-direction:column; gap:14px; }
    .choice-btn {
      font-family:inherit; font-size:2.8rem; font-weight:bold;
      padding:22px 20px; border:none; border-radius:24px;
      cursor:pointer; letter-spacing:4px;
      box-shadow:0 6px 0 rgba(0,0,0,0.15); color:white;
      text-shadow:2px 2px 0 rgba(0,0,0,0.2); width:100%;
      transition:transform 0.12s, box-shadow 0.12s, opacity 0.2s;
    }
    .choice-btn:last-child { margin-bottom:10px; }
    .choice-btn:nth-child(1) { background:linear-gradient(135deg,#f72585,#b5179e); }
    .choice-btn:nth-child(2) { background:linear-gradient(135deg,#4361ee,#3a0ca3); }
    .choice-btn:nth-child(3) { background:linear-gradient(135deg,#f77f00,#d62828); }
    .choice-btn:hover  { transform:scale(1.05) translateY(-3px); box-shadow:0 10px 0 rgba(0,0,0,0.15); outline:none; }
    .choice-btn:active { transform:scale(0.97) translateY(2px);  box-shadow:0 3px 0 rgba(0,0,0,0.15); }

    /* â”€â”€ Feedback overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .feedback {
      position:fixed; inset:0; display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      font-size:5rem; font-weight:bold;
      z-index:100; opacity:0; pointer-events:none; transition:opacity 0.2s;
    }
    .feedback.show    { opacity:1; }
    .feedback.correct { background:rgba(144,190,109,0.92); color:white; }
    .feedback.wrong   { background:rgba(255,107,107,0.88); color:white; }
    .feedback-emoji   { font-size:7rem; animation:bounceIn 0.4s ease; }
    .feedback-text    { font-size:3.5rem; text-shadow:3px 3px 0 rgba(0,0,0,0.15); margin-top:10px; animation:bounceIn 0.4s ease; }
    .feedback-subtext { font-size:1.8rem; margin-top:8px; opacity:0.85; }
    @keyframes bounceIn {
      0%  {transform:scale(0.3);opacity:0;}
      60% {transform:scale(1.15);}
      100%{transform:scale(1);opacity:1;}
    }

    /* â”€â”€ Confetti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #confetti-canvas { position:fixed; inset:0; pointer-events:none; z-index:99; }

    /* â”€â”€ Quiz win banner (inline, not fullscreen) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .quiz-win {
      display:none; background:linear-gradient(135deg,#d4f5e9,#fff9c4);
      border:4px solid #90be6d; border-radius:28px;
      padding:24px 20px; margin-bottom:16px;
      animation:bounceIn 0.4s ease;
    }
    .quiz-win.show { display:block; }
    .quiz-win-emoji { font-size:3.5rem; }
    .quiz-win-text  { font-size:1.8rem; font-weight:bold; color:#2d6a4f; margin-top:6px; }
    .quiz-win-sub   { font-size:1.1rem; color:#666; margin-top:4px; }
    .quiz-win-stars { font-size:2rem; color:#f9c74f; margin:8px 0; }
    .btn-restart-quiz {
      font-family:inherit; font-size:1.4rem; font-weight:bold;
      padding:14px 34px; border:none; border-radius:24px;
      background:linear-gradient(135deg,#f77f00,#f72585);
      color:white; cursor:pointer; margin-top:10px;
      box-shadow:0 5px 0 rgba(0,0,0,0.15);
      transition:transform 0.12s;
    }
    .btn-restart-quiz:hover { transform:scale(1.06) translateY(-2px); }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width:500px) {
      .game-card  { padding:20px 14px 44px; }
      .fc-word    { font-size:4rem; }
      .target-word{ font-size:3.2rem; }
      .choice-btn { font-size:2rem; padding:18px 12px; }
      .title      { font-size:1.7rem; }
      .feedback-text { font-size:2.5rem; }
      .color-check-label { font-size:0.88rem; padding:6px 12px; }
      .mode-toggle-btn { font-size:1rem; padding:12px 16px; }
    }
  </style>
</head>
<body>

<div class="star" style="top:8%;left:5%;animation-delay:0s">â­</div>
<div class="star" style="top:15%;right:7%;animation-delay:1s">ğŸŒŸ</div>
<div class="star" style="bottom:12%;left:9%;animation-delay:2s">âœ¨</div>
<div class="star" style="bottom:20%;right:6%;animation-delay:0.5s">â­</div>
<div class="star" style="top:45%;left:2%;animation-delay:1.5s">ğŸŒŸ</div>
<div class="star" style="top:55%;right:3%;animation-delay:2.5s">âœ¨</div>

<canvas id="confetti-canvas"></canvas>

<div class="feedback" id="feedback">
  <div class="feedback-emoji"   id="feedback-emoji"></div>
  <div class="feedback-text"    id="feedback-text"></div>
  <div class="feedback-subtext" id="feedback-subtext"></div>
</div>

<div class="game-card">
  <div class="title">ğŸŒˆ Rainbow Words! ğŸŒˆ</div>

  <!-- â”€â”€ Mode toggle â”€â”€ -->
  <div class="mode-toggle">
    <button class="mode-toggle-btn active-flash" id="btn-mode-flash" onclick="switchMode('flash')">
      ğŸ“– Flashcards
    </button>
    <button class="mode-toggle-btn inactive" id="btn-mode-quiz" onclick="switchMode('quiz')">
      ğŸ¯ Quiz
    </button>
  </div>

  <!-- Color filter -->
  <div class="color-panel">
    <div class="color-panel-title">ğŸ¨ Pick which colors to practice:</div>
    <div class="color-checks" id="color-checks"></div>
    <div>
      <button class="mini-btn" onclick="selectAllColors()">âœ… Select All</button>
      <button class="mini-btn" onclick="clearAllColors()">âŒ Clear All</button>
    </div>
  </div>

  <div class="no-words-msg" id="no-words-msg">ğŸ˜… Please pick at least one color above to play!</div>

  <!-- Flag filter row -->
  <div class="flag-filter-row">
    <button class="flag-filter-btn" id="flag-filter-btn" onclick="toggleFlagFilter()">
      ğŸš© Flagged Words Only
      <span class="flag-count-badge" id="flag-count-badge">0</span>
    </button>
    <button class="mini-btn" onclick="clearAllFlags()" style="border-color:#ffb3b3;color:#d62828;">ğŸ—‘ï¸ Clear All Flags</button>
  </div>

  <!-- Progress dots -->
  <div class="progress-dots" id="progress-dots"></div>

  <!-- â•â• FLASHCARD MODE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="flashcard-area" class="show">

    <div class="fc-counter" id="fc-counter">Word 1 of 10</div>

    <div class="flashcard" id="flashcard" onclick="speakCurrentFC()">
      <div class="fc-rings">
        <div class="ring"></div>
        <div class="ring"></div>
        <div class="ring"></div>
      </div>
      <!-- Flag button â€” stopPropagation so it doesn't trigger the card's speak -->
      <button class="flag-btn" id="flag-btn"
        onclick="event.stopPropagation(); toggleFlag()"
        title="Flag this word for extra practice">ğŸš©</button>
      <div class="fc-seen-badge" id="fc-seen-badge">âœ“</div>
      <div class="fc-word"        id="fc-word">â€”</div>
      <div class="fc-color-label" id="fc-color-label"></div>
      <div class="fc-tap-hint">ğŸ‘† Tap card to hear it!</div>
    </div>

    <div class="fc-nav">
      <button class="fc-nav-btn btn-prev" id="btn-prev" onclick="fcPrev()">â† Back</button>
      <button class="fc-nav-btn btn-next" id="btn-next" onclick="fcNext()">Next â†’</button>
    </div>

  </div>

  <!-- â•â• QUIZ MODE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="quiz-area">

    <!-- Inline win banner -->
    <div class="quiz-win" id="quiz-win">
      <div class="quiz-win-emoji">ğŸ‰</div>
      <div class="quiz-win-text">You finished!</div>
      <div class="quiz-win-sub"   id="quiz-win-sub"></div>
      <div class="quiz-win-stars" id="quiz-win-stars"></div>
      <button class="btn-restart-quiz" onclick="startQuiz()">Play Again! ğŸ¯</button>
    </div>

    <div id="quiz-question">
      <div class="score-bar">
        <div class="score-item">â­ Stars: <span id="star-count">0</span></div>
        <div class="score-item">ğŸ”¥ Streak: <span id="streak-count">0</span></div>
      </div>

      <div class="quiz-instruction">Tap ğŸ”Š to hear the word, then find it! ğŸ‘‡</div>

      <div class="target-word-box" id="target-word-box">
        <div class="target-word"   id="target-word">â€”</div>
        <div class="rainbow-label" id="rainbow-label">ğŸŒˆ Rainbow Word</div>
        <div class="speak-row">
          <button class="speak-btn" id="speak-btn" onclick="speakQuizWord()">
            <span class="speaker-icon">ğŸ”Š</span> Hear it!
          </button>
        </div>
      </div>

      <div class="choices" id="choices">
        <button class="choice-btn" onclick="checkAnswer(this)">â€”</button>
        <button class="choice-btn" onclick="checkAnswer(this)">â€”</button>
        <button class="choice-btn" onclick="checkAnswer(this)">â€”</button>
      </div>
    </div>

  </div>

</div><!-- /game-card -->

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// WORD DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COLOR_DATA = [
  { id:'purple',   label:'ğŸ’œ Purple',   fcClass:'fc-purple',   themeClass:'theme-purple',   labelClass:'label-purple',   words:['a','I','like','the','at','do','to','we'] },
  { id:'blue',     label:'ğŸ’™ Blue',     fcClass:'fc-blue',     themeClass:'theme-blue',     labelClass:'label-blue',     words:['he','she','me','be','play','see','go','you','an','and','can','ran'] },
  { id:'green',    label:'ğŸ’š Green',    fcClass:'fc-green',    themeClass:'theme-green',    labelClass:'label-green',    words:['was','his','is','in','if','it','into','for','or','eat','thank','as','has','us'] },
  { id:'yellow',   label:'ğŸ’› Yellow',   fcClass:'fc-yellow',   themeClass:'theme-yellow',   labelClass:'label-yellow',   words:['up','but','little','big','set','get','let','are','have','about','out','know','with','all','call','my'] },
  { id:'orange',   label:'ğŸ§¡ Orange',   fcClass:'fc-orange',   themeClass:'theme-orange',   labelClass:'label-orange',   words:['by','why','kind','find','no','so','yes','love','friend','jump','one','because','help','when','what','red','blue','hot'] },
  { id:'red',      label:'â¤ï¸ Red',      fcClass:'fc-red',      themeClass:'theme-red',      labelClass:'label-red',      words:['got','not','on','said','two','her','him','look','three','yellow','some','come','here','green','am','funny','happy','pretty','white','black','brown','down'] },
  { id:'sunshine', label:'â˜€ï¸ Sunshine', fcClass:'fc-sunshine', themeClass:'theme-sunshine', labelClass:'label-sunshine', words:['now','how','our','house','make','of','put','want','saw','this'] },
];

const ALL_WORDS_FLAT = [...new Set(COLOR_DATA.flatMap(c => c.words))];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let activeColors  = new Set(COLOR_DATA.map(c => c.id));
let gameWords     = [];
let currentMode   = 'flash'; // 'flash' | 'quiz'
let flaggedOnly   = false;   // when true, only show flagged words

// Load flags from localStorage (persists across sessions)
let flaggedWords = new Set(JSON.parse(localStorage.getItem('rainbowFlags') || '[]'));

function saveFlags() {
  localStorage.setItem('rainbowFlags', JSON.stringify([...flaggedWords]));
}

function toggleFlag() {
  const word = gameWords[fcIndex]?.word;
  if (!word) return;
  if (flaggedWords.has(word)) flaggedWords.delete(word);
  else                        flaggedWords.add(word);
  saveFlags();
  updateFlagUI();
  updateFlagCountBadge();
}

function updateFlagUI() {
  const word = gameWords[fcIndex]?.word;
  const btn  = document.getElementById('flag-btn');
  if (!btn || !word) return;
  const isFlagged = flaggedWords.has(word);
  btn.classList.toggle('flagged', isFlagged);
  btn.title = isFlagged ? 'Remove flag' : 'Flag this word for extra practice';
}

function updateFlagCountBadge() {
  // count flags within currently active colors
  const pool = buildWordPool();
  const count = pool.filter(item => flaggedWords.has(item.word)).length;
  const badge = document.getElementById('flag-count-badge');
  if (badge) badge.textContent = count;

  // disable "Flagged Only" if no flags
  const btn = document.getElementById('flag-filter-btn');
  if (btn) btn.style.opacity = count === 0 ? '0.45' : '1';
}

function toggleFlagFilter() {
  // don't toggle on if no flags exist in pool
  const pool  = buildWordPool();
  const count = pool.filter(item => flaggedWords.has(item.word)).length;
  if (!flaggedOnly && count === 0) return; // nothing to show

  flaggedOnly = !flaggedOnly;
  document.getElementById('flag-filter-btn').classList.toggle('active', flaggedOnly);

  if (currentMode === 'flash') startStudy();
  else                         startQuiz();
}

function clearAllFlags() {
  flaggedWords.clear();
  saveFlags();
  // always drop out of flagged-only mode
  flaggedOnly = false;
  document.getElementById('flag-filter-btn').classList.remove('active');
  updateFlagCountBadge();
  // restart the current mode so the full word pool is rebuilt
  if (currentMode === 'flash') startStudy();
  else                         startQuiz();
}

// flashcard
let fcIndex = 0;
let seenSet = new Set();

// quiz
let quizIndex = 0;
let quizWord  = '';
let quizColor = null;
let stars     = 0;
let streak    = 0;
let locked    = false;

const CORRECT_MESSAGES = [
  ['ğŸ‰','Great job!','You got it!'],
  ['â­','Awesome!','Super reader!'],
  ['ğŸŒŸ','Yes!','You\'re so smart!'],
  ['ğŸŠ','Woohoo!','Way to go!'],
  ['ğŸ’«','Perfect!','Keep it up!'],
  ['ğŸ¦„','Amazing!','You\'re a star!'],
  ['ğŸ€','Fantastic!','So proud of you!'],
];
const WRONG_MESSAGES = [
  ['ğŸ’ª','Try again!','You can do it!'],
  ['ğŸ˜Š','Oops!','Look carefully!'],
  ['ğŸ”','Not quite!','Try once more!'],
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MODE SWITCHING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchMode(mode) {
  currentMode = mode;
  speechSynthesis.cancel();

  // update toggle button styles
  document.getElementById('btn-mode-flash').className =
    'mode-toggle-btn ' + (mode === 'flash' ? 'active-flash' : 'inactive');
  document.getElementById('btn-mode-quiz').className =
    'mode-toggle-btn ' + (mode === 'quiz' ? 'active-quiz' : 'inactive');

  // show/hide sections
  document.getElementById('flashcard-area').style.display = mode === 'flash' ? 'block' : 'none';
  document.getElementById('quiz-area').style.display      = mode === 'quiz'  ? 'block' : 'none';

  if (mode === 'flash') startStudy();
  else                  startQuiz();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// COLOR FILTER UI
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildColorFilters() {
  const container = document.getElementById('color-checks');
  container.innerHTML = '';
  COLOR_DATA.forEach(c => {
    const label = document.createElement('label');
    label.className = `color-check-label ${c.labelClass}`;
    label.id = `chk-label-${c.id}`;
    const cb = document.createElement('input');
    cb.type = 'checkbox'; cb.checked = true; cb.id = `chk-${c.id}`;
    cb.addEventListener('change', () => {
      if (cb.checked) activeColors.add(c.id);
      else            activeColors.delete(c.id);
      label.classList.toggle('unchecked', !cb.checked);
      // restart whichever mode is active
      if (currentMode === 'flash') startStudy();
      else                         startQuiz();
    });
    const customCb = document.createElement('span');
    customCb.className = 'custom-cb';
    label.appendChild(cb);
    label.appendChild(customCb);
    label.appendChild(document.createTextNode(` ${c.label} (${c.words.length})`));
    container.appendChild(label);
  });
}

function selectAllColors() {
  COLOR_DATA.forEach(c => {
    activeColors.add(c.id);
    const cb = document.getElementById(`chk-${c.id}`);
    if (cb) { cb.checked = true; document.getElementById(`chk-label-${c.id}`).classList.remove('unchecked'); }
  });
  if (currentMode === 'flash') startStudy(); else startQuiz();
}
function clearAllColors() {
  COLOR_DATA.forEach(c => {
    activeColors.delete(c.id);
    const cb = document.getElementById(`chk-${c.id}`);
    if (cb) { cb.checked = false; document.getElementById(`chk-label-${c.id}`).classList.add('unchecked'); }
  });
  if (currentMode === 'flash') startStudy(); else startQuiz();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SHARED
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildWordPool() {
  const pool = [];
  COLOR_DATA.forEach(c => {
    if (activeColors.has(c.id)) {
      c.words.forEach(w => {
        if (!flaggedOnly || flaggedWords.has(w)) {
          pool.push({ word: w, colorId: c.id });
        }
      });
    }
  });
  return pool;
}

function checkPool() {
  const pool = buildWordPool();
  const noMsg = document.getElementById('no-words-msg');
  if (pool.length === 0) {
    noMsg.textContent = flaggedOnly
      ? 'ğŸš© No flagged words yet! Tap ğŸš© on a card to flag it first.'
      : 'ğŸ˜… Please pick at least one color above to play!';
    noMsg.classList.add('show');
    document.getElementById('progress-dots').innerHTML = '';
    return null;
  }
  noMsg.classList.remove('show');
  return pool;
}

function buildDots(count, doneUpTo, phase) {
  const container = document.getElementById('progress-dots');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const d    = document.createElement('div');
    const word = gameWords[i]?.word;
    const isFl = word && flaggedWords.has(word);
    if (phase === 'study') {
      const state = i < doneUpTo ? ' done' : i === doneUpTo ? ' current' : '';
      d.className = 'dot' + state + (isFl && !state.includes('done') ? ' flagged-dot' : '');
    } else {
      d.className = 'dot' + (isFl ? ' flagged-dot' : '');
      d.id = 'qdot-' + i;
    }
    if (word) d.title = word; // hover to see the word
    container.appendChild(d);
  }
}
function updateQuizDot(i, result) {
  const d = document.getElementById('qdot-' + i);
  if (d) d.className = 'dot ' + result;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â• FLASHCARD MODE â•â•
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startStudy() {
  speechSynthesis.cancel();
  seenSet.clear();
  fcIndex = 0;

  const pool = checkPool();
  if (!pool) return;

  gameWords = shuffle([...pool]);
  buildDots(gameWords.length, 0, 'study');
  loadFlashcard();
}

function loadFlashcard() {
  const item  = gameWords[fcIndex];
  const color = COLOR_DATA.find(c => c.id === item.colorId);

  document.getElementById('fc-word').textContent        = item.word;
  document.getElementById('fc-color-label').textContent = color.label + ' Word';
  document.getElementById('fc-counter').textContent     = `Word ${fcIndex + 1} of ${gameWords.length}`;

  const card = document.getElementById('flashcard');
  card.className = 'flashcard ' + color.fcClass;

  document.getElementById('fc-seen-badge').classList.toggle('visible', seenSet.has(item.word));
  seenSet.add(item.word);

  updateFlagUI();

  document.getElementById('btn-prev').style.visibility =
    fcIndex === 0 ? 'hidden' : 'visible';

  // On last card, Next just loops back to first (no auto quiz jump)
  const btnNext = document.getElementById('btn-next');
  if (fcIndex === gameWords.length - 1) {
    btnNext.textContent = 'ğŸ”„ Start Over';
    btnNext.className   = 'fc-nav-btn btn-prev'; // grey restart look
    btnNext.onclick     = () => { fcIndex = 0; seenSet.clear(); loadFlashcard(); };
  } else {
    btnNext.textContent = 'Next â†’';
    btnNext.className   = 'fc-nav-btn btn-next';
    btnNext.onclick     = fcNext;
  }

  buildDots(gameWords.length, fcIndex, 'study');
}

function speakCurrentFC() { speakWord(gameWords[fcIndex].word, false); }
function fcNext() { if (fcIndex < gameWords.length - 1) { fcIndex++; loadFlashcard(); } }
function fcPrev() { if (fcIndex > 0) { fcIndex--; loadFlashcard(); } }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â• QUIZ MODE â•â•
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startQuiz() {
  speechSynthesis.cancel();
  stars = 0; streak = 0; quizIndex = 0; locked = false;

  const pool = checkPool();
  if (!pool) return;

  gameWords = shuffle([...pool]);

  // hide win banner, show question
  document.getElementById('quiz-win').classList.remove('show');
  document.getElementById('quiz-question').style.display = 'block';

  updateScore();
  buildDots(gameWords.length, -1, 'quiz');
  loadQuizQuestion();
}

function loadQuizQuestion() {
  locked = false;
  const item = gameWords[quizIndex];
  quizWord   = item.word;
  quizColor  = COLOR_DATA.find(c => c.id === item.colorId);

  document.getElementById('target-word').textContent   = quizWord;
  document.getElementById('rainbow-label').textContent = quizColor.label + ' Word';
  document.getElementById('target-word-box').className = 'target-word-box ' + quizColor.themeClass;

  const distractors = shuffle(ALL_WORDS_FLAT.filter(w => w !== quizWord)).slice(0, 2);
  const options = shuffle([quizWord, ...distractors]);

  document.querySelectorAll('.choice-btn').forEach((btn, i) => {
    btn.textContent     = options[i];
    btn.dataset.word    = options[i];
    btn.style.opacity   = '1';
    btn.style.transform = '';
  });
}

function speakQuizWord() { speakWord(quizWord, true); }

function checkAnswer(btn) {
  if (locked) return;
  locked = true;

  speakWord(btn.dataset.word, true);

  const correct = btn.dataset.word === quizWord;

  if (correct) {
    stars++; streak++;
    updateScore();
    updateQuizDot(quizIndex, 'correct');
    const msg = CORRECT_MESSAGES[Math.floor(Math.random() * CORRECT_MESSAGES.length)];
    showFeedback(true, msg[0], msg[1], msg[2]);
    launchConfetti();
    setTimeout(() => {
      hideFeedback();
      quizIndex++;
      if (quizIndex >= gameWords.length) showQuizWin();
      else loadQuizQuestion();
    }, 1400);
  } else {
    streak = 0;
    updateScore();
    updateQuizDot(quizIndex, 'wrong');
    const msg = WRONG_MESSAGES[Math.floor(Math.random() * WRONG_MESSAGES.length)];
    showFeedback(false, msg[0], msg[1], msg[2]);
    document.querySelectorAll('.choice-btn').forEach(b => {
      b.style.opacity = b.dataset.word === quizWord ? '1' : '0.3';
    });
    setTimeout(() => {
      hideFeedback();
      locked = false;
      document.querySelectorAll('.choice-btn').forEach(b => b.style.opacity = '1');
    }, 1400);
  }
}

function showQuizWin() {
  document.getElementById('quiz-question').style.display = 'none';
  const win = document.getElementById('quiz-win');
  win.classList.add('show');
  document.getElementById('quiz-win-stars').textContent = 'â­'.repeat(Math.min(stars, 12)) || 'â­';
  document.getElementById('quiz-win-sub').textContent   =
    `You got ${stars} out of ${gameWords.length} right! ğŸ‰`;
  launchConfetti(true);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCORE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateScore() {
  document.getElementById('star-count').textContent   = stars;
  document.getElementById('streak-count').textContent = streak;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEEDBACK
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showFeedback(correct, emoji, text, sub) {
  const el = document.getElementById('feedback');
  el.className = 'feedback show ' + (correct ? 'correct' : 'wrong');
  document.getElementById('feedback-emoji').textContent   = emoji;
  document.getElementById('feedback-text').textContent    = text;
  document.getElementById('feedback-subtext').textContent = sub;
}
function hideFeedback() { document.getElementById('feedback').className = 'feedback'; }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFETTI
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas = document.getElementById('confetti-canvas');
const ctx    = canvas.getContext('2d');
let confettiPieces = [], animating = false;
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

function launchConfetti(big = false) {
  const count  = big ? 200 : 90;
  const colors = ['#f72585','#4361ee','#4cc9f0','#90be6d','#f9c74f','#f77f00','#06d6a0','#9b72cf'];
  for (let i = 0; i < count; i++) {
    confettiPieces.push({
      x: Math.random()*canvas.width, y:-10,
      w: Math.random()*14+6, h:Math.random()*8+4,
      color: colors[Math.floor(Math.random()*colors.length)],
      vx:(Math.random()-0.5)*5, vy:Math.random()*5+2,
      angle:Math.random()*360, spin:(Math.random()-0.5)*8, life:1,
    });
  }
  if (!animating) animateConfetti();
}
function animateConfetti() {
  animating = true;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  confettiPieces = confettiPieces.filter(p => p.life > 0);
  confettiPieces.forEach(p => {
    p.x+=p.vx; p.y+=p.vy; p.angle+=p.spin; p.life-=0.012;
    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.angle*Math.PI/180);
    ctx.globalAlpha=Math.max(0,p.life); ctx.fillStyle=p.color;
    ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();
  });
  if (confettiPieces.length>0) requestAnimationFrame(animateConfetti);
  else { animating=false; ctx.clearRect(0,0,canvas.width,canvas.height); }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SPEECH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let speechReady = false;
function unlockSpeech() {
  if (speechReady) return;
  const u = new SpeechSynthesisUtterance(''); u.volume = 0;
  speechSynthesis.speak(u); speechReady = true;
}
document.addEventListener('click', unlockSpeech, { once: true });
if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = () => {};

function speakWord(word, isQuiz = false) {
  if (!('speechSynthesis' in window) || !word) return;
  speechSynthesis.cancel();

  const card     = document.getElementById('flashcard');
  const speakBtn = document.getElementById('speak-btn');

  const utter = new SpeechSynthesisUtterance(word);
  utter.rate   = 0.80;
  utter.pitch  = 1.05;
  utter.volume = 1;

  const voices    = speechSynthesis.getVoices();
  const preferred = voices.find(v => /en[-_](US|GB|AU)/i.test(v.lang) && !v.name.includes('Google'))
                 || voices.find(v => /en/i.test(v.lang));
  if (preferred) utter.voice = preferred;

  utter.onstart = () => {
    if (!isQuiz && card) card.classList.add('speaking');
    if (isQuiz && speakBtn) {
      speakBtn.classList.add('speaking');
      speakBtn.querySelector('.speaker-icon').textContent = 'ğŸ”ˆ';
    }
  };
  utter.onend = utter.onerror = () => {
    if (card)     card.classList.remove('speaking');
    if (speakBtn) {
      speakBtn.classList.remove('speaking');
      speakBtn.querySelector('.speaker-icon').textContent = 'ğŸ”Š';
    }
  };

  speechSynthesis.speak(utter);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UTILITY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function shuffle(arr) {
  for (let i = arr.length-1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// Keyboard shortcuts
document.addEventListener('keydown', e => {
  if (currentMode === 'flash') {
    if (e.key==='ArrowRight' || e.key===' ') document.getElementById('btn-next').click();
    if (e.key==='ArrowLeft')                 document.getElementById('btn-prev').click();
    if (e.key==='r' || e.key==='R')          speakCurrentFC();
  } else {
    if (e.key==='1') document.querySelectorAll('.choice-btn')[0]?.click();
    if (e.key==='2') document.querySelectorAll('.choice-btn')[1]?.click();
    if (e.key==='3') document.querySelectorAll('.choice-btn')[2]?.click();
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
buildColorFilters();
updateFlagCountBadge();
startStudy();
// set initial visibility
document.getElementById('flashcard-area').style.display = 'block';
document.getElementById('quiz-area').style.display      = 'none';
</script>
</body>
</html>
